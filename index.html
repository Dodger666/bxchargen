<!DOCTYPE html>
<html>
  <head>
	  <title>Danger Is Real: Générateur de Personnages Basic b/x et autres jeux OSR</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
	 <link href="https://fonts.googleapis.com/css2?family=Lakki+Reddy&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=0.75" charset="utf-8"/>
    <script>
//#region funtions 
      var essential_items = ['sac à dos', 'pierre à feu', 'outre', 'rations (7)'];
      var light_source_items = ['lanterne ( 2 flasques d\'huile)', 'torches (6)'];
      var mundane_items = ['petit marteau', 'gros clous (12)', 'mirroir',
                           'corde (15 m)', 'grand sac', 'petit sac',
                           'wolfsbane', 'perche de 3m', 'caltrop (6)'];
      var melee_weapons = ['hache de guerre', 'hache', 'dague', 'dague en argent',
                           'épée courte', 'épée', 'épée à deux mains', 'masse d\'arme', 'gourdin', 'hallebarde', 'lance', 'marteau de guerre', 'baton'];
      var ranged_weapons = ['arbalète (30 quarreaux)', 'arc long (20 flèches)',
                            'arc court (20 flèches)', 'fronde (30 pierres)',
                            'javelot'];
      var armor = ['cuir', 'cotte de mailles', 'armure de plates'];

      const encumbrances = {
        'hache de guerre': 50, 'gourdin': 50, 'arbalète (30 quarreaux)': 50, 'dague': 10,
        'hache': 30, 'javelin': 20, 'arc long (20 flèches)': 30, 'masse d\'arme': 30,'hallebarde': 150, 'arc court (20 flèches)': 30, 'dague en argent': 10,
        'fronde (30 pierres)': 20, 'lance': 30, 'baton': 40, 'épée': 60,
        'épée courte': 30, 'épée à deux mains': 150, 'marteau de guerre': 30,
        'cuir': 200, 'cotte de mailles': 400, 'armure de plates': 500, 'bouclier': 100
      };

      const appearances = ["aquilin", "athlétique", "poitrine en tonneau", "osseux",
                           "musclé", "brutal", "cou de taureau", "ciselé",
                           "gros nez", "corpulent", "édenté", "delicate",
                           "sillonné", "décharné", "magnifique", "grisonnant",
                           "hagard", "beau", "hideux", "longiligne", "rondouillard",
                           "déchiré", "rose", "maigre", "tendu", "mince",
                           "affaissé", "solide", "à la mâchoire carrée", "statuesque",
                           "imposant", "élancé", "usé", "sâle", "nerveux",
                           "ridée"]
	  
      function get_appearance() {
        return choose(appearances);
      }

      function get_generic_gear() {
        var inv = [].concat(essential_items);
        inv.push(choose(light_source_items));
        var items = [].concat(mundane_items);
        for (i = 0; i < 3; i++) {
          var item = choose(items);
          inv.push(item);
          items = items.filter(k => k !== item);
        }
        return inv;
      }

      const wrap = (s) => s.replace(
        /(?![^\n]{1,60}$)([^\n]{1,60})\s/g, '$1\n'
      );

      function consolidator(some_array) {
        var stuff = {};
        for (var i = 0; i < some_array.length; i++) {
          if (stuff.hasOwnProperty(some_array[i])) {
            stuff[some_array[i]] += 1;
          } else {
            stuff[some_array[i]] = 1;
          }
        }
        var consolidated = []
        const keys = Object.keys(stuff);
        for (const key of keys) {
          if (stuff[key] > 1) {
            consolidated.push(`${key} (x${stuff[key]})`);
          } else {
            consolidated.push(key);
          }
        }
        return consolidated
      }

      function choose(some_array) {
        return some_array[Math.floor(Math.random()*some_array.length)]
      }

      function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min + 1) ) + min;
      }

      function d(how_many, sides){
        var total = 0;
        var i;
        for (i = 0; i < how_many; i++) {
          total += getRndInteger(1, sides);
        }
        return total;
      }

      function get_background() {
        var bgs = [];
        bgs = bgs.concat(Array(3).fill('Dresseur d\'animaux'));
        bgs = bgs.concat(Array(2).fill('Armurier'));
        bgs = bgs.concat(Array(4).fill('Boulanger'));
        bgs = bgs.concat(Array(3).fill('Forgeron'));
        bgs = bgs.concat(Array(1).fill('Libraire'));
        bgs = bgs.concat(Array(4).fill('Fabricant d\'arc/Flèche'));
        bgs = bgs.concat(Array(4).fill('Brasseur'));
        bgs = bgs.concat(Array(3).fill('Boucher'));
        bgs = bgs.concat(Array(3).fill('Charpentier'));
        bgs = bgs.concat(Array(3).fill('Magasinier'));
        bgs = bgs.concat(Array(3).fill('tonnelier'));
        bgs = bgs.concat(Array(2).fill('tonnelier'));
        bgs = bgs.concat(Array(10).fill('Fermier'));
        bgs = bgs.concat(Array(4).fill('Pêcheur'));
        bgs = bgs.concat(Array(4).fill('Fourreur'));
        bgs = bgs.concat(Array(1).fill('Souffleur de verre'));
        bgs = bgs.concat(Array(4).fill('Chasseur'));
        bgs = bgs.concat(Array(3).fill('Bijoutier'));
        bgs = bgs.concat(Array(3).fill('Sellier'));
        bgs = bgs.concat(Array(1).fill('Cartographeur'));
        bgs = bgs.concat(Array(3).fill('Maçon'));
        bgs = bgs.concat(Array(3).fill('Mineur'));
        bgs = bgs.concat(Array(3).fill('Potier'));
        bgs = bgs.concat(Array(2).fill('Cordier'));
        bgs = bgs.concat(Array(3).fill('Marin'));
        bgs = bgs.concat(Array(3).fill('Charpentier Naval'));
        bgs = bgs.concat(Array(3).fill('Tailleur'));
        bgs = bgs.concat(Array(3).fill('Tanneur'));
        bgs = bgs.concat(Array(3).fill('Chaumier'));
        bgs = bgs.concat(Array(3).fill('Bûcheron'));
        bgs = bgs.concat(Array(2).fill('Vigneron'));
        bgs = bgs.concat(Array(1).fill('Noble Bâtard'));
        return choose(bgs);
      }

      function get_personality(num=2) {
        var traits = ["rustre", "agressif", "arrogant", "cruel",
                      "compulsif", "grossier", "paranoïaque", "cupide", "haineux","ambitieux", "fou", "intolérant", "luxurieux",
                      "pessimiste", "distrait", "aimable", "nerveux",
                      "excentrique", "maniaque", "froussard", "espiègle",
                      "loquace", "nostalgique", "humble", "curieux",
                      "dragueur", "téméraire", "flamboyant", "stoïque",
                      "grégaire", "secret", "naïf", "fier", "taciturne",
                      "superstitieux", "dévoué", "amical", "fidèle",
                      "éloquent", "courageux", "prudent", "célibataire",
                      "généreux", "joyeux", "confiant", "poli",
                      "résolu", "persuasif", "travailleur", "strict", "miséricordieux", "au cœur tendre", "protecteur", "serviable", "honorable", "loyal", "astucieux", "pur"];
        var selected = [];
        for (i=0; i < num; i++) {
          var trait = choose(traits);
          selected.push(trait);
          traits = traits.filter(k => k !== trait);
        }
        return selected.join(', ');

      }
	  
	  function get_xp_bonus_single(prime_abi){
	  var bonus = [null,null,null,'-20%','-20%','-20%','-10%','-10%','-10%','0%','0%','0%','0%','+5%','+5%','+5%','+10%','+10%','+10%' ];
	  return bonus[prime_abi];}
	  
	  function get_xp_bonus_elf(intelligence, strength){
		  if (intelligence >= 16 && strength>=13) {return '+10%'};
		  if (intelligence >= 13 && strength>=13) {return '+5%'};
		  return '0%'
	  }
	  function get_xp_bonus_halfling(dex, strength){
		  if (dex >= 16 && strength>=16) {return '+10%'};
		  if (dex >= 13 || strength>=13) {return '+5%'};
		  return '0%'
	  }
	  function get_extra_languages(intelligence, specs){
		  var all_languages = ['Doppelgänger',
'dragon',
'elfique',
'gargouille',
'gnoll',
'gnome',
'gobelin',
'gobelours',
'harpie',
'hobgobelin',
'homme-lézard',
'kobold',
'minotaure',
'méduse',
'nain',
'ogre',
'orque',
'pixie',
'halfling']
		  var nb_lang = 0
		  if (intelligence > 12){nb_lang = 1}
		  if (intelligence > 15){nb_lang = 2}
		  if (intelligence > 17){nb_lang = 3}
          var selected = [];
		  var i = 1
          while(i <= nb_lang) {
            var lang = choose(all_languages);
            if (!specs.includes(lang)){
				selected.push(lang);
	            all_languages = all_languages.filter(k => k !== lang);
				i++
            }
          }
		  if (selected.length > 0){
			  return ', ' + selected.join(', ');}
          return ''
	  	
	  }
	  
//#endregion funtions 

      class Abilities {
        constructor () {
          this.strength = d(3, 6);
          this.dexterity = d(3, 6);
          this.constitution = d(3, 6);
          this.intelligence = d(3, 6);
          this.wisdom = d(3, 6);
          this.charisma = d(3, 6);
          this.mod = [null, null, null, '-3', '-2', '-2', '-1', '-1', 
                      '-1', '  ', '  ', '  ', '  ', '+1', '+1', '+1',
                      '+2', '+2', '+3'];
          this.mod_cha = [null, null, null, '-2', '-1', '-1', '-1', '-1', 
                      '-1', '  ', '  ', '  ', '  ', '+1', '+1', '+1',
                      '+1', '+1', '+2'];
          this.explo_open_door = [null, null, null, '1', '1', '1', '1', '1', 
                      '1', '2', '2', '2', '2', '3', '3', '3',
                      '4', '4', '5'];
        }
        get abi_list() {
          return [this.strength, this.dexterity, this.constitution,
                  this. intelligence, this.wisdom, this.charisma]
        }
        get strmod() {
          return this.mod[this.strength]
        }
        get dexmod() {
          return this.mod[this.dexterity]
        }
        get conmod() {
          return this.mod[this.constitution]
        }
        get intmod() {
          return this.mod[this.intelligence]
        }
        get wismod() {
          return this.mod[this.wisdom]
        }
        get chamod() {
          return this.mod_cha[this.charisma]
        }
        get open_door_chance() {
          return this.explo_open_door[this.strength]
        }
        say_abis() {
          return `
Force:        ${("  " + this.strength).slice(-2)} ${this.strmod}
Dextérité:    ${("  " + this.dexterity).slice(-2)} ${this.dexmod}
Constitution: ${("  " + this.constitution).slice(-2)} ${this.conmod}
Intelligence: ${("  " + this.intelligence).slice(-2)} ${this.intmod}
Sagesse:      ${("  " + this.wisdom).slice(-2)} ${this.wismod}
Charisme:     ${("  " + this.charisma).slice(-2)} ${this.chamod}`
        }

      }


      class Cleric {
        constructor(abis) {
          this.name = "Clerc";
	  this.hd = 6;
	  this.max_level = 14;
          this.xp_progression = [1500, 3000, 6000, 12000, 25000, 50000,
                                 100000, 200000, 300000, 400000, 500000,
                                 600000, 700000];
          this.thaco_array = [20, 19, 19, 19, 19, 17, 17, 17, 17, 14, 14, 14,
                              14, 12, 12]
          this.post_name_level_hp_gain = 1;
          this.specs = wrap('Armures : toutes, boucliers compris. Armes : toutes les armes contondantes. Magie Divine. Vade Retro. Langues : langue d\’alignement, commun');
		  this.explo = {'EP': '1','OP':'0', 'PS': '1','TP':'1' };
		  this.xp_bonus = get_xp_bonus_single(abis.wisdom)
        }
        class_equipment() {
          var inv = ['eau bénite', 'symbole sacré'];
          inv.push(choose(armor));
          inv.push(choose(['masse d\'arme', 'baton', 'marteau de guerre']));
		  inv.push('bouclier');
          return inv;
        }
      }


      class Dwarf {
        constructor(abis) {
			if (abis.constitution < 9){abis.constitution = 9}
          this.name = "Nain";
	  	  this.hd = 8;
	  	  this.max_level = 12;
          this.xp_progression = [2200, 4400, 8800, 17000, 35000, 70000,
                                 140000, 270000, 400000, 530000, 660000]
          this.thaco_array = [20, 19, 19, 19, 17, 17, 17, 14, 14, 14,
                              12, 12, 12];
          this.post_name_level_hp_gain = 3;
          this.specs = wrap('Armures : toutes, boucliers compris. Armes : petites ou normales uniquement. Infravistion (18m). Langues: langue d\’alignement, commun, nain, gnome, gobelin, kobold');
		  this.explo = {'EP': '2','OP':'0', 'PS':'2','TP':'2' };
		  this.xp_bonus = get_xp_bonus_single(abis.strength)
		}
        class_equipment() {
          var inv = [];
          var dwarf_melee_weapons = ['hache', 'hache de guerre', 'dague',
                                     'épée courte', 'épée', 'masse d\'arme',
                                     'gourdin', 'lance', 'marteau de guerre'];
          var dwarf_ranged = ranged_weapons.filter(k => !k.includes('long'));
          inv.push(choose(armor));
          inv.push(choose(dwarf_melee_weapons));
          inv.push(choose(dwarf_ranged));
		  inv.push('bouclier');
          return inv;
        }
      }


      class Elf {
        constructor(abis) {
			if (abis.intelligence < 9){abis.intelligence = 9}
          this.name = "Elfe";
	  this.hd = 6;
	  this.max_level = 10;
          this.xp_progression = [4000, 8000, 16000, 32000, 64000, 120000,
                                 250000, 400000, 600000];
          this.thaco_array = [20, 19, 19, 19, 17, 17, 17, 14, 14, 14, 12]
          this.post_name_level_hp_gain = 2;
          this.specs = wrap('Magie Arcanique. Les elfes peuvent utiliser tous les types d’armes et d’armures. Immunité à la paralysie des goules. Infravision (18m). Langues : langue d\’alignement, commun, elfique, gnoll, hobgobelin, orque');
          this.explo = {'EP': '2','OP':'0', 'PS':'2','TP':'1' };
		  this.xp_bonus = get_xp_bonus_elf(abis.intelligence, abis.strength)
		}
        class_equipment() {
          var inv = ['spellbook'];
          inv.push(choose(armor));
          inv.push(choose(melee_weapons));
          inv.push(choose(ranged_weapons));
		  inv.push('bouclier');
          return inv;
        }
      }


      class Fighter {
        constructor(abis) {
          this.name = "Guerrier";
	  this.hd = 8;
	  this.max_level = 14;
          this.xp_progression = [2000, 4000, 8000, 16000, 32000, 64000,
                                 120000, 240000, 360000, 480000, 600000,
                                 720000, 840000]
          this.thaco_array = [20, 19, 19, 19, 17, 17, 17, 14, 14, 14, 12, 12,
                              12, 10, 10]
          this.post_name_level_hp_gain = 2;
          this.specs = wrap('Armures : toutes, boucliers compris, Armes : toutes, Enchainement: peut touchez plusieurs adversaires, Langues : langue d\’alignement, commun');
          this.explo = {'EP': '1','OP':'0', 'PS': '1','TP':'1' };
		  this.xp_bonus = get_xp_bonus_single(abis.strength)
		}
        class_equipment() {
          var inv = [];
          inv.push(choose(armor));
          var melee_weapon = choose(melee_weapons);
          inv.push(melee_weapon);
          var big_weapons = ['épée à deux mains', 'hallebarde', 'hache de guerre'];
          if (!big_weapons.includes(melee_weapon)) {
            inv.push('bouclier');
          }
          inv.push(choose(ranged_weapons));
          return inv;
        }
      }


      class Halfling {
        constructor(abis) {
			if (abis.constitution < 9){abis.constitution = 9}
			if (abis.dexterity < 9){abis.dexterity = 9}
          this.name = "Halfling";
	  this.hd = 6;
	  this.max_level = 8;
          this.xp_progression = [2000, 4000, 8000, 16000, 32000, 64000,
                                 120000]
          this.thaco_array = [20, 19, 19, 19, 17, 17, 17, 14, 14, 14]
          this.post_name_level_hp_gain = 0;
          this.specs = wrap('Armures : toutes (de tailles appropriées), bouclier compris. Armes : toutes (de taille appropriée). +2 en CA contre les grandes créature. 90% chance de se cacher dans les bois; 2-in-6 de se cacher dans l\'ombre en donjon. +1 aux jets d’attaque avec des projectiles. Langues : langue d\’alignement, commun, halfling');
          this.explo = {'EP': '2','OP':'0', 'PS': '1','TP':'1' };
		  this.xp_bonus = get_xp_bonus_halfling(abis.dexterity, abis.strength)
		}
        class_equipment() {
          var inv = [];
          var dwarf_melee_weapons = ['hache', 'dague', 'épée courte', 'masse d\'arme','gourdin', 'lance', 'marteau de guerre'];					 
          var dwarf_ranged = ranged_weapons.filter(k => !k.includes('long'));
          inv.push(choose(armor));
          inv.push(choose(dwarf_melee_weapons));
          inv.push(choose(dwarf_ranged));
          return inv
        }
      }


      class MagicUser {
        constructor(abis) {
          this.name = "Magicien";
	  this.hd = 4;
	  this.max_level = 14;
          this.xp_progression = [2500, 5000, 10000, 20000, 40000,
                                 80000, 150000, 300000, 450000, 600000,
                                 750000, 900000, 1050000]
          this.thaco_array = [20, 19, 19, 19, 19, 19, 17, 17, 17, 17, 17, 14,
                              14, 14, 14]
          this.post_name_level_hp_gain = 1;
          this.specs = wrap('Magie Arcanique. Armures : aucune. Armes : dagues, baton. Langues : langue d\’alignement, commun');
          this.explo = {'EP': '1','OP':'0', 'PS': '1','TP':'1' };
		  this.xp_bonus = get_xp_bonus_single(abis.intelligence)
		}
        class_equipment() {
          var inv = ['livre de sorts', 'dague', 'baton'];
          return inv;
        }
      }


      class Thief {
        constructor(abis) {
          this.name = "Voleur";
	  this.hd = 4;
	  this.max_level = 14;
          this.xp_progression = [1200, 2400, 4800, 9600, 20000, 40000,
                                 80000, 160000, 280000, 400000, 520000,
                                 640000, 760000]
          this.thaco_array = [20, 19, 19, 19, 19, 17, 17, 17, 17, 14, 14, 14,
                              14, 12, 12]
          this.post_name_level_hp_gain = 2;
          this.specs = wrap('Armures : cuir, pas de bouclier. Armes : toutes. Quand il attaque par derrière un adversaire qui ne s’y attend pas, le voleur reçoit un bonus de +4 à l’attaque et double les dégâts infligés. Langues : langue d\’alignement, commun');
          this.explo = {'EP': '2','OP':'0', 'PS': '1','TP':'1' };
		  this.xp_bonus = get_xp_bonus_single(abis.dexterity)
		  this.skills = {'C': 1,'DS':1, 'DD': 1,'EP':1, 'PB':2, 'PP':1, 'SC':1};
		  var skills_lvl1 = ['C','DS', 'DD','EP', 'PB', 'PP', 'SC']
		  this.skills[choose(skills_lvl1)] ++
		  this.skills[choose(skills_lvl1)] ++
		  this.skills[choose(skills_lvl1)] ++
		  this.skills[choose(skills_lvl1)] ++
		}
        class_equipment() {
          var inv = ['outils de voleur', 'cuir'];
          inv.push(choose(melee_weapons));
          inv.push(choose(ranged_weapons));
          return inv;
        }
      }
      cleric_spells_per_day = [
          [0, 0, 0, 0, 0, 0],
          [0, 1, 0, 0, 0, 0],
          [0, 1, 0, 0, 0, 0],
          [0, 2, 0, 0, 0, 0],
          [0, 2, 1, 0, 0, 0],
          [0, 2, 2, 0, 0, 0],
          [0, 2, 2, 1, 1, 0],
          [0, 2, 2, 2, 1, 1],
          [0, 3, 3, 2, 2, 1],
          [0, 3, 3, 3, 2, 2],
          [0, 4, 4, 3, 3, 2],
          [0, 4, 4, 4, 3, 3],
          [0, 5, 5, 4, 4, 3],
          [0, 5, 5, 5, 4, 4],
          [0, 6, 5, 5, 5, 4]
      ]

      mu_spells_per_day = [
          [0, 0, 0, 0, 0, 0, 0],
          [0, 1, 0, 0, 0, 0, 0],
          [0, 2, 0, 0, 0, 0, 0],
          [0, 2, 1, 0, 0, 0, 0],
          [0, 2, 2, 0, 0, 0, 0],
          [0, 2, 2, 1, 0, 0, 0],
          [0, 2, 2, 2, 0, 0, 0],
          [0, 3, 2, 2, 1, 0, 0],
          [0, 3, 3, 2, 2, 0, 0],
          [0, 3, 3, 3, 2, 1, 0],
          [0, 3, 3, 3, 3, 2, 0],
          [0, 4, 3, 3, 3, 2, 1],
          [0, 4, 4, 3, 3, 3, 2],
          [0, 4, 4, 4, 3, 3, 3],
          [0, 4, 4, 4, 4, 3, 3]
      ]

      cleric_spells = [
        null,
        ["Anéantissement de la peur (Peur)",
"Détection de la magie",
"Détection du mal",
"Guérison des blessures légères (Blessures légères)",
"Lumière (Ténèbres)",
"Protection contre le mal",
"Purification de l’eau et des aliments",
"Résistance au froid"],
        ['bless', 'find traps', 'hold person', 'know alignment', 'resist fire',
         'silence (15\') radius', 'snake charm', 'speak with animals'],
        ['continual light', 'cure disease', 'growth of animal',
         'locate object', 'remove curse', 'striking'],
        ['create water', 'cure serious wounds', 'neutralize poison',
         'protection from evil (10\' radius)', 'speak with plants',
         'sticks to snakes'],
        ['commune', 'create food', 'dispel evil', 'insect plague', 'quest',
         'raise dead']
      ]

      mu_spells = [
        null,
        ['Bouclier',
		  'Charme-personne',
		  'Détection de la magie',
		  'Disque flottant',
		  'Fermeture',
		  'Lecture de la magie',
		  'Lecture des langues',
		  'Lumière (Ténèbres)',
		  'Projectile magique',
		  'Protection from Evil',
		  'Sommeil',
		  'Ventriloquisme'],
        ['continual light', 'detect evil', 'detect invisible', 'ESP',
         'invisibility', 'knock', 'levitate', 'locate object', 'mirror image',
         'phantasmal force', 'web', 'wizard lock'],
        ['clairvoyance', 'dispel magic', 'fireball', 'fly', 'haste', 'hold person',
         'infravistion', 'invisibility (10\' radius)', 'lightning bolt',
         'protection from evil (10\' radius)', 'protection from normal missiles',
         'water breathing'],
        ['charm monster', 'confusion', 'dimension door', 'growth of plants',
         'hallucinatory terrain', 'massmorph', 'polymorph others',
         'polymorph self', 'remove curse', 'wall of fire', 'wall of ice',
         'wizard eye'],
        ['animate dead', 'cloudkill', 'conjeure elemental', 'contact higher plane',
         'feeblemind', 'hold monster', 'magic jar', 'pass-wall', 'telekenesis',
         'teleport', 'transmute rock to mud', 'wall of stone'],
        ['anti-magic shell', 'control weather', 'death spell', 'disintegrate',
         'geas', 'invisible stalker', 'lower water', 'move earth', 'part water',
         'projected image', 'reincarnation', 'stone to flesh'],
      ]

      function generate_spellbook(caster_level, intelligence) {
        var spells = [];
		var nb_spells = [null,null, null, 1,1,1,2,2,2,2,3,3,3,3,3,4,4,4,5]
		if (caster_level == 1){
			 var available_spells = mu_spells[1];
			 for (i = 1; i <= nb_spells[intelligence]; i++){
			lvl_1_spells = mu_spells_per_day[caster_level][i]
		    var random_spell = choose(available_spells);
			spells.push(random_spell);
			available_spells = available_spells.filter(k => k !== random_spell);
		}
		}else{
        for (i = 1; i < 7; i++) {
          var available_spells = mu_spells[i];
          for (k = 0; k < mu_spells_per_day[caster_level][i]; k++) {
            var random_spell = choose(available_spells);
            spells.push(random_spell);
            available_spells = available_spells.filter(k => k !== random_spell);
          }
        }
	}
        return wrap(spells.join(', '));
      }


      class Character {
        constructor(name='', abis=null, char_class=null) {
          this.name = name;
	  
	  		if (abis === null) {
          	  this.abis = new Abilities();
         	 } else {
          	   this.abis = abis;
          	}
		  if (char_class === null) {
	            this.char_class = new Fighter(this.abis);
	          } else {
	            this.char_class = new char_class(this.abis);
	          }
          this.background = get_background();
          this.personality = get_personality();
          this.level = 1;
          this.xp = 0;
          this.hp = this.char_class.hd + Number(this.abis.conmod);
          this.inventory = this.generate_inventory();
          this.appearance = get_appearance();
		  this.explo_skills = this.char_class.explo
		  this.explo_skills['OP'] = this.abis.open_door_chance
		  
        }
        level_up() {
          if (this.level < this.char_class.max_level) {
            if (this.level < 10) {
              this.hp += Math.max(d(1, this.char_class.hd) + Number(this.abis.conmod), 1);
            } else {
              this.hp += this.char_class.post_name_level_hp_gain;
            }
            this.xp = this.char_class.xp_progression[this.level - 1]
            this.level += 1;
          }
        }
        generate_inventory() {
          var inv_array = get_generic_gear();
          inv_array = inv_array.concat(this.char_class.class_equipment());
          const coins = d(3, 6);
          this.encumbrance = 80 + coins;
          for (const k of inv_array) {
            if (Object.keys(encumbrances).includes(k)) {
              this.encumbrance += encumbrances[k];
            }
          }
          inv_array.push(`pièces d\'or (${coins})`);
          inv_array.sort();
          var inv = inv_array.join(', ');
          inv = wrap(inv, 120);
          return inv;
        }
        get move(){
          if (this.encumbrance > 800) {
            return '9m (3m)';
          } else if (this.encumbrance > 600) {
            return '12m (6m)'
          } else if (this.encumbrance > 400) {
            return '27m (9m)'
          } else {
            return '36m (12m)'
          }
        }
        get ac() {
	  var inv = this.inventory.replace(/\n/g, ' ')
          if (inv.includes('armure de plates')) {
            var base_ac = 3;
          } else if (inv.includes('cotte de mailles')) {
            var base_ac = 5;
          } else if (inv.includes('cuir')) {
            var base_ac = 7;
          } else {
            var base_ac = 9;
          }
          if (this.inventory.includes('bouclier')) {
            base_ac += 1;
          }
          return 19 - base_ac + Number(this.abis.dexmod);
        }
        get base_thac0() {
          return 19 - this.char_class.thaco_array[this.level]
        }
        get melee_thac0() {
          return this.base_thac0 + Number(this.abis.strmod);
        }
        get ranged_thac0() {
          var hobbit_bonus = 0
          if (this.char_class.name === 'Halfling') {
            hobbit_bonus = 1
          }
          return this.base_thac0 + Number(this.abis.dexmod) + hobbit_bonus;
        }
        get character_sheet() {
          const ncol = 23;
          var name_bit = `Nom: ${this.name}`.padEnd(ncol);
          var level_bit = `Niveau: ${this.level}`.padEnd(ncol);
          var class_bit = `Classe: ${this.char_class.name}`.padEnd(ncol);
          var statblock = this.abis.say_abis().split('\n');
          statblock[1] += `    DV: d${this.char_class.hd} / PV: ${this.hp}`;
          statblock[2] += `    CA: ${this.ac}`;
          statblock[3] += `    Bonus (melee): ${this.melee_thac0}`;
          statblock[4] += `    Bonus (distance): ${this.ranged_thac0}`;
          statblock[5] += `    MOVEMENT: ${this.move}`;
          statblock[6] += `    XP: ${this.xp} / Bonus: ${this.char_class.xp_bonus}`;
          var spells = '';
          if (this.char_class.name === 'Clerc') {
            var spd = cleric_spells_per_day[this.level].slice(1);
            spells = `\nSORTS PAR JOUR (PAR NIVEAU): ${spd.join(', ')}\n`;
          } else if (this.char_class.name === 'Magicien'
                     || this.char_class.name === 'Elfe') {
            const spd = mu_spells_per_day[this.level].slice(1).join(', ');
            const book = generate_spellbook(this.level, this.abis.intelligence);
            spells = `\nSORTS PAR JOUR (PAR NIVEAU): ${spd}\n\nLIVRE DE SORTS:\n${book}\n`;
          }
		  var thief_skills = ''
		  if ((this.char_class.name === 'Voleur') )
		  {
			  thief_skills =`\nTALENTS DE VOLEURS:\nCrochetage: ${this.char_class.skills['C']}-6\n`
		  }
          return `
${name_bit}Profession: ${this.background}
${level_bit}Aparence: ${this.appearance}
${class_bit}Personalité: ${this.personality}
${statblock.join('\n')}

EXPLORATION:
Ecouter aux portes: ${this.char_class.explo['EP']}-6, Ouverture des portes: ${this.char_class.explo['OP']}-6,
Trouver portes secrètes: ${this.char_class.explo['PS']}-6, Trouver pièges de salle: ${this.char_class.explo['TP']}-6
${thief_skills}
ABILITES SPECIALES:
${this.char_class.specs}${get_extra_languages(this.abis.intelligence, this.char_class.specs)}
${spells}
EQUIPEMENT:
${this.inventory}

ENCOMBREMENT:
${this.encumbrance} pièces`;
        }
      }
    </script>
  </head>
  <body onload="roll_up_char(1, 'rando', 'Truc')">
    <div style="max-width:500px; margin:auto">
	  <pre style="font-family:'Lakki Reddy';text-align:justify;font-size:1.2em;">Générateur de Personnages Basic b/x et autres jeux OSR</pre>
      <p style="font-family:'Courier Prime';text-align:justify;monospace;font-size:0.77em;">Compatible avec <a href="https://oldschoolessentials.necroticgnome.com/srd/index.php/Main_Page">OSE</a> avec au niveau 1: Max PV, Clerc 1 sort/niv 1, livre de sort modifié par l'intelligence et talents de voleurs d6</p>
      <label for="level" style="font-family:'Courier Prime';text-align:justify;monospace;font-size:0.77em;">Niveau: </label>
      <input type="number" name="level" id="level" value=1  style="width:3em">
      <label for="classy" style="font-family:'Courier Prime';text-align:justify;monospace;font-size:0.77em;">Classe: </label>
      <select name="classy" id="classy">
        <option value="rando">aléatoire</option>
        <option value="cleric">clerc</option>
        <option value="dwarf">nain</option>
        <option value="elf">elfe</option>
        <option value="fighter">guerrier</option>
        <option value="halfling">halfling</option>
        <option value="magic user">magicien</option>
        <option value="thief">voleur</option>
      </select>
      <label for="name" style="font-family:'Courier Prime';text-align:justify;monospace;font-size:0.77em;">Nom: </label>
      <input type="text" name="name" id="name" value=Truc  style="width:6em">
      <button onclick="roll_up_char(document.getElementById('level').value, document.getElementById('classy').value, document.getElementById('name').value)">Rouler!</button>
      <pre id="sheet" style="font-family: 'Courier Prime', monospace;font-size:0.87em;"/>
    </div>
    <script>
      function roll_up_char (level=1, cls='rando', name) {
        var abis = new Abilities();
        if (cls === 'rando') {
          max_abi = Math.max(...abis.abi_list);
          if (abis.strength === max_abi) {
            if (abis.intelligence > 9 && Math.random() < 0.07) {
              cls = 'elf';
            } else {
              cls = 'fighter';
            }
          } else if (abis.constitution > 9 && abis.constitution === max_abi
                     && Math.random() < 0.4) {
            cls = 'dwarf';
          } else if (abis.dexterity === max_abi) {
            if (abis.constitution > 9 && abis.dexterity > 9 && Math.random() < 0.2) {
              cls = 'halfling';
            } else {
              cls = 'thief';
            }
          } else if (abis.intelligence === max_abi) {
            if (abis.intelligence > 9 && Math.random() < 0.7) {
              cls = 'elf';
            } else {
            cls = 'magic user';
            }
          } else if (abis.wisdom === max_abi) {
            cls = 'cleric';
          } else {
          cls = ['cleric', 'fighter',
                 'magic user', 'thief'][Math.floor(Math.random()*7)]
          }
        }
        classes = {
          cleric: Cleric,
          dwarf: Dwarf,
          elf: Elf,
          fighter: Fighter,
          halfling: Halfling,
          'magic user': MagicUser,
          thief: Thief
        }
        var new_char = new Character(name, abis, classes[cls]);
        for (i = 0; i < level - 1; i++) {
          new_char.level_up()
        }
        document.getElementById('sheet').innerHTML = new_char.character_sheet;
      }
    </script>
  </body>
</html>

